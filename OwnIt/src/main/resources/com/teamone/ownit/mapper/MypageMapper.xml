<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.teamone.ownit.mapper.MypageMapper">

	<!-- 류혜지 -->
	
	<!-- 회원정보 조회	 -->
	<select id="selectMemberInfo" resultType="com.teamone.ownit.vo.MypageVO">
        SELECT 
        	i.image_original_file1,
        	m.member_id, 
 			m.member_nickname,
			m.member_name,
			m.member_image,
			m.member_phone,
			a.address_zipcode,
			a.address1,
			a.address2   	 
				FROM member m
				LEFT JOIN address a
				ON a.address_idx = m.member_idx
				LEFT JOIN image i
				ON m.member_idx = i.member_idx
				WHERE member_id=#{member_id}
    </select>	
    
	<!-- 구매내역 게시글 갯수 -->
	<select id="selectMySellListCount" resultType="integer">
		SELECT 
			COUNT(*) 
			FROM member m
				LEFT JOIN image i
				ON m.member_idx = i.product_idx
				LEFT JOIN order_sell o
				ON m.member_idx = o.order_sell_idx
				LEFT JOIN product p
				ON m.member_idx = p.product_idx				
				WHERE member_id=#{id}			
			
	</select>	
	
	<!-- 구매내역 게시글 -->
	<select id="selectMySell" resultType="com.teamone.ownit.vo.MypageSellListVO">
        SELECT 
        	m.member_id,
        	i.image_real_file1,
        	p.product_name, 
			p.product_sell_price,
			o.order_sell_idx,
 			o.order_sell_date,
			o.order_sell_gb
				FROM member m
				LEFT JOIN image i
				ON m.member_idx = i.product_idx
				LEFT JOIN order_sell o
				ON m.member_idx = o.order_sell_idx
				LEFT JOIN product p
				ON m.member_idx = p.product_idx	
			WHERE member_id=#{id}
			ORDER BY 
				o.order_sell_idx DESC
			LIMIT #{startRow}, #{listLimit}
    </select>	
    
    <!-- 비밀번호 조회 -->	
	<select id="selectPasswd" resultType="String">
		SELECT member_passwd 
			FROM member
			WHERE member_id=#{sId}
	</select>
	
	<!-- 비밀번호 변경 -->    
	<update id="updateMember">
		UPDATE member
			SET
				member_passwd = #{secureNewPassword}
			WHERE 
				member_id = #{member.member_id}
	</update>	
	
	<!-- 위시리스트 불러오기 -->	
    <select id="selectWishlist" resultType="com.teamone.ownit.vo.WishlistVO">
        SELECT 
			m.member_idx,
			m.member_id,
			p.product_idx,
			p.product_name,
        	i.image_real_file1
					FROM wishlist w
					LEFT JOIN member m
					ON w.member_idx = m.member_idx
					LEFT JOIN product p
					ON w.product_idx = p.product_idx	
					LEFT JOIN image i
					ON w.product_idx = i.product_idx	
				WHERE w.member_idx=#{member_idx}
				LIMIT #{startRow}, #{listLimit}				
    </select>

	<!-- 위시리스트 갯수 조회 -->	    
	<select id="selectWishlistCount" resultType="integer">
		SELECT COUNT(*) 
			FROM wishlist w
				LEFT JOIN member m
				ON w.member_idx = m.member_idx
				LEFT JOIN product p
				ON w.product_idx = p.product_idx	
				LEFT JOIN image i
				ON w.product_idx = i.product_idx
			WHERE w.member_idx=#{member_idx}
	</select>
	
	<!-- 위시리스트 삭제 -->
	<delete id="deleteWishlist">
		DELETE FROM wishlist
			WHERE 
				member_idx = #{member_idx}
			AND 
				product_idx = #{product_idx}
	</delete>
	
	<!-- 주소록 목록 -->	
    <select id="selectAddress" resultType="com.teamone.ownit.vo.AddressVO">
        SELECT 
			m.member_idx,
			m.member_id,
			a.address_idx,
			a.address_zipcode,
			a.address1,
			a.address2,
			a.address_recipient,
			a.address_gb,
			a.address_nickname
				FROM address a
				LEFT JOIN member m
				ON a.member_idx = m.member_idx
				WHERE m.member_idx=#{member_idx}
    </select>

	<!-- 주소록 갯수 조회 -->
	<select id="selectAddressCount" resultType="integer">
	SELECT COUNT(*) 
		FROM address
		WHERE member_idx=#{member_idx}
	</select>

	<!-- 주소록 추가 -->
	<insert id="insertAddress">
		insert into address
			values(
				null,
				#{member_idx},
				#{address.address_zipcode},
				#{address.address1},
				#{address.address2},
				'1',
				#{address.address_nickname},
				#{address.address_recipient}
			)
	</insert>

	<!-- 주소록 삭제 -->
	<delete id="deleteAddress">
		DELETE
			FROM address
			WHERE 
				address_idx = #{address_idx}
	</delete>



































































































































<!-- 정채연 -->
</mapper> 
