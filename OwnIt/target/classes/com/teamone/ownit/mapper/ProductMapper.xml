<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.teamone.ownit.mapper.ProductMapper">
	<select id="getProductList" resultType="com.teamone.ownit.vo.ProductVO">
      SELECT p.product_idx, product_brand, product_name, product_buy_price, wish, i.image_original_file1, i.image_original_file2,
      		(SELECT COUNT(*) FROM wishlist ww WHERE ww.product_idx = p.product_idx AND ww.member_idx = (SELECT member_idx FROM member WHERE member_id = #{sId})) AS myWish
		  FROM product p 
		  LEFT OUTER JOIN (SELECT product_idx,COUNT(*) wish FROM wishlist group by product_idx) w
		    ON p.product_idx = w.product_idx
		  INNER JOIN (SELECT product_idx, image_original_file1, image_original_file2 FROM image) i
		    ON p.product_idx = i.product_idx
		  ORDER BY wish DESC;
   </select>

	<select id="getCategorisedProduct" resultType="com.teamone.ownit.vo.ProductVO">
      SELECT p.product_idx, product_type, product_brand, product_name, product_buy_price, wish, i.image_original_file1, i.image_original_file2,
      (SELECT COUNT(*) FROM wishlist ww WHERE ww.product_idx = p.product_idx AND ww.member_idx = (SELECT member_idx FROM member WHERE member_id = #{sId})) AS myWish
		  FROM product p 
		  LEFT OUTER JOIN (SELECT product_idx ,COUNT(*) wish FROM wishlist group by product_idx) w
		    ON p.product_idx = w.product_idx
		  INNER JOIN (SELECT product_idx, image_original_file1, image_original_file2 FROM image) i
		    ON p.product_idx = i.product_idx
		  <if test="!id.equals('')">
		  	<choose>
		  		<when test="id.equals('스마트폰')">
		  			WHERE product_type = #{id}
		  		</when>
		  		<when test="id.equals('태블릿')">
		  			WHERE product_type = #{id}
		  		</when>
		  		<when test="id.equals('스마트워치')">
		  			WHERE product_type = #{id}
		  		</when>
		  		<when test="id.equals('이어폰')">
		  			WHERE product_type = #{id}
		  		</when>
		  		<when test="id.equals('헤드폰')">
		  			WHERE product_type = #{id}
		  		</when>
		  		<when test="id.equals('노트북')">
		  			WHERE product_type = #{id}
		  		</when>
		 	</choose>
		  </if> 
		  ORDER BY wish DESC;
   </select>

	<select id="arrayByCategory" resultType="com.teamone.ownit.vo.ProductVO">
      SELECT p.product_idx, product_type, product_brand, product_name, product_buy_price, wish, i.image_original_file1, i.image_original_file2,
      	(SELECT COUNT(*) FROM wishlist ww WHERE ww.product_idx = p.product_idx AND ww.member_idx = (SELECT member_idx FROM member WHERE member_id = #{sId})) AS myWish
		  FROM product p 
		  LEFT OUTER JOIN (SELECT product_idx ,COUNT(*) wish FROM wishlist group by product_idx) w
		    ON p.product_idx = w.product_idx
		  INNER JOIN (SELECT product_idx, image_original_file1, image_original_file2 FROM image) i
		    ON p.product_idx = i.product_idx
		  <if test="!id.equals('')">
		  	<choose>
		  		<when test="id.equals('product_popular')">
		  			ORDER BY wish DESC
		  		</when>
		  		<when test="id.equals('price_high')">
		  			ORDER BY ABS(product_buy_price) DESC
		  		</when>
		  		<when test="id.equals('price_low')">
		  			ORDER BY ABS(product_buy_price)
		  		</when>
		  		<when test="id.equals('product_new')">
		  			ORDER BY product_date DESC
		  		</when>
		 	</choose>
		  </if> 
   </select>

	<select id="checkLike" resultType="int">
		SELECT COUNT(*) FROM wishlist
		WHERE member_idx = (SELECT member_idx FROM member WHERE member_id = #{sId})
		AND	  product_idx = #{product_idx}
	</select>

	<insert id="addLike">
		INSERT INTO wishlist
		VALUES ((SELECT member_idx FROM member WHERE member_id = #{sId}), #{product_idx})
	</insert>

	<delete id="deleteLike">
		DELETE FROM wishlist
		WHERE member_idx = (SELECT member_idx FROM member WHERE member_id = #{sId}) AND product_idx = #{product_idx}
	</delete>




























































































































































































































































































































































































































<!-- 박주닮 -->
	<select id="productDetail" resultType="com.teamone.ownit.vo.ProductVO">
		SELECT 
			* FROM product
			WHERE product_idx=#{product_idx}
		
	</select>

	<select id="selectDetailImage" resultType="com.teamone.ownit.vo.ImageVO">
		SELECT * FROM image
		WHERE image_idx=#{product_idx}
	</select>



































































































































































































































































































































































































</mapper>